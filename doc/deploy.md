# 部署文档

## 得到可执行文件
本项目由 Go 1.17 编译得到，如果要自己编译，注意需要选择正确的 Go 编译器版本，有些功能使用了高版本特性（比如内嵌文件，从 Go 1.16 开始支持）。

懒一点的话，可以直接去GitHub Release里下载。

## 系统安装 Chrome 浏览
平时怎么装软件，就正常安装即可。Linux 各发行版的包管理工具应该都可以下载开源版本 Chromium，下这个就好。

## 执行jksbx
直接执行即可。

当然也可以传命令行参数，传 `-h` 可以查看参数说明。目前支持如下：

- `-e` 开关，表示是否需要有头浏览器，忽略则为不需要。
- `-s <HHMM>` 每天开始自动申报的时间，格式为24小时制HHMM，如七点半为730，晚上八点整为2000。
- `-a <address>` 表示WEB服务的监听地址，默认监听 0.0.0.0:8080。
- `-q <queueSize>` 表示请求申报的队列数目，如果已经满了，则新的请求不会被处理，默认250。
- `-c <concurrency>` 表示并发进行申报的协程数目，注意这个只是“立即申报”功能的协程数目，每日为所有账户自动申报的功能是跑在一个单独的独立协程上的。默认5。
- `-m <filename>` 指定OCR模型文件路径，忽略则使用内嵌默认模型。
- `-u <filename>` 用户数据库文件路径，忽略则为当前目录的user.db。

## 极简客户端
服务跑起来之后，项目README中提到的那三个 API 就可以调用了。项目提供了一个非常简单的网页客户端，可以直接浏览器输入 `localhost:8080` 访问。

## 公网跑服务
如果要在公网上跑这个服务，最好使用HTTPS来提供安全支持，否则密码将以明文形式在互联网上传输。

如果有域名，可以去letsencrpyt上免费得到SSL证书；如果懒得搞，可以自己签发证书，然后自己的浏览器添加信任即可（但是其他人浏览你的网站仍然会收到浏览器的警告）。
